<?xml version="1.0" encoding="UTF-8"?>
<testsuite name="no.nav.paw.arbeidssokerregisteret.auth.TokenxAuthenticationTest" tests="9" skipped="0" failures="0" errors="0" timestamp="2024-05-03T04:07:00" hostname="nav-j4op-hpzg9" time="1.215">
  <properties/>
  <testcase name="Unauthenticated request should return 401" classname="no.nav.paw.arbeidssokerregisteret.auth.TokenxAuthenticationTest" time="0.07"/>
  <testcase name="Request with wrong issuer should return 401" classname="no.nav.paw.arbeidssokerregisteret.auth.TokenxAuthenticationTest" time="0.118"/>
  <testcase name="Request with wrong audience should return 401" classname="no.nav.paw.arbeidssokerregisteret.auth.TokenxAuthenticationTest" time="0.153"/>
  <testcase name="Request with too low acr claim should return 401" classname="no.nav.paw.arbeidssokerregisteret.auth.TokenxAuthenticationTest" time="0.14"/>
  <testcase name="Request without pid claim should return 401" classname="no.nav.paw.arbeidssokerregisteret.auth.TokenxAuthenticationTest" time="0.153"/>
  <testcase name="Request without expired token should return 401" classname="no.nav.paw.arbeidssokerregisteret.auth.TokenxAuthenticationTest" time="0.156"/>
  <testcase name="Request with malformed token should return 401" classname="no.nav.paw.arbeidssokerregisteret.auth.TokenxAuthenticationTest" time="0.108"/>
  <testcase name="Authenticated request should return 200" classname="no.nav.paw.arbeidssokerregisteret.auth.TokenxAuthenticationTest" time="0.151"/>
  <testcase name="For a authenticated TokenX request we should be able to resolve the pid" classname="no.nav.paw.arbeidssokerregisteret.auth.TokenxAuthenticationTest" time="0.155"/>
  <system-out><![CDATA[2024-05-03 06:07:00.788  INFO k.test:167 - No ktor.deployment.watch patterns specified, automatic reload is not active.
2024-05-03 06:07:00.853  INFO k.test:65 - Application started in 0.066 seconds.
2024-05-03 06:07:00.853  INFO k.test:77 - Responding at http://localhost:80
2024-05-03 06:07:00.853  INFO k.test:77 - Responding at https://localhost:443
2024-05-03 06:07:00.861  INFO k.test:167 - No ktor.deployment.watch patterns specified, automatic reload is not active.
2024-05-03 06:07:00.971  INFO k.test:65 - Application started in 0.111 seconds.
2024-05-03 06:07:00.971  INFO k.test:77 - Responding at http://localhost:80
2024-05-03 06:07:00.972  INFO k.test:77 - Responding at https://localhost:443
2024-05-03 06:07:00.986  INFO k.test:167 - No ktor.deployment.watch patterns specified, automatic reload is not active.
2024-05-03 06:07:01.080  INFO k.test:65 - Application started in 0.094 seconds.
2024-05-03 06:07:01.080  INFO k.test:77 - Responding at http://localhost:80
2024-05-03 06:07:01.081  INFO k.test:77 - Responding at https://localhost:443
2024-05-03 06:07:01.126  INFO n.n.s.t.s.c.v.JwtTokenValidationHandler:65 - Found invalid token for issuer [http://localhost:40501/default, expires at null], message:Token validation failed: JWT audience rejected: [wrong-audience] 
2024-05-03 06:07:01.133  INFO k.test:167 - No ktor.deployment.watch patterns specified, automatic reload is not active.
2024-05-03 06:07:01.224  INFO k.test:65 - Application started in 0.091 seconds.
2024-05-03 06:07:01.225  INFO k.test:77 - Responding at http://localhost:80
2024-05-03 06:07:01.225  INFO k.test:77 - Responding at https://localhost:443
2024-05-03 06:07:01.274  INFO k.test:167 - No ktor.deployment.watch patterns specified, automatic reload is not active.
2024-05-03 06:07:01.370  INFO k.test:65 - Application started in 0.097 seconds.
2024-05-03 06:07:01.372  INFO k.test:77 - Responding at http://localhost:80
2024-05-03 06:07:01.373  INFO k.test:77 - Responding at https://localhost:443
2024-05-03 06:07:01.431  INFO k.test:167 - No ktor.deployment.watch patterns specified, automatic reload is not active.
2024-05-03 06:07:01.531  INFO k.test:65 - Application started in 0.101 seconds.
2024-05-03 06:07:01.532  INFO k.test:77 - Responding at http://localhost:80
2024-05-03 06:07:01.533  INFO k.test:77 - Responding at https://localhost:443
2024-05-03 06:07:01.586  INFO k.test:167 - No ktor.deployment.watch patterns specified, automatic reload is not active.
2024-05-03 06:07:01.685  INFO k.test:65 - Application started in 0.099 seconds.
2024-05-03 06:07:01.686  INFO k.test:77 - Responding at http://localhost:80
2024-05-03 06:07:01.686  INFO k.test:77 - Responding at https://localhost:443
2024-05-03 06:07:01.686  WARN n.n.s.t.s.c.v.JwtTokenRetriever:48 - Received exception when attempting to extract and parse token from Authorization header
java.lang.RuntimeException: java.text.ParseException: Invalid JWT serialization: Missing dot delimiter(s)
	at no.nav.security.token.support.core.jwt.JwtToken.<init>(JwtToken.java:22)
	at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)
	at java.base/java.util.AbstractList$RandomAccessSpliterator.forEachRemaining(AbstractList.java:722)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:575)
	at java.base/java.util.stream.AbstractPipeline.evaluateToArrayNode(AbstractPipeline.java:260)
	at java.base/java.util.stream.ReferencePipeline.toArray(ReferencePipeline.java:616)
	at java.base/java.util.stream.ReferencePipeline.toArray(ReferencePipeline.java:622)
	at java.base/java.util.stream.ReferencePipeline.toList(ReferencePipeline.java:627)
	at no.nav.security.token.support.core.validation.JwtTokenRetriever.getTokensFromHeader(JwtTokenRetriever.java:44)
	at no.nav.security.token.support.core.validation.JwtTokenRetriever.retrieveUnvalidatedTokens(JwtTokenRetriever.java:25)
	at no.nav.security.token.support.core.validation.JwtTokenValidationHandler.getValidatedTokens(JwtTokenValidationHandler.java:29)
	at no.nav.security.token.support.v2.TokenSupportAuthenticationProvider.onAuthenticate(TokenSupportAuthenticationProvider.kt:61)
	at io.ktor.server.auth.AuthenticationInterceptorsKt$AuthenticationInterceptors$2$1.invokeSuspend(AuthenticationInterceptors.kt:102)
	at io.ktor.server.auth.AuthenticationInterceptorsKt$AuthenticationInterceptors$2$1.invoke(AuthenticationInterceptors.kt)
	at io.ktor.server.auth.AuthenticationInterceptorsKt$AuthenticationInterceptors$2$1.invoke(AuthenticationInterceptors.kt)
	at io.ktor.server.auth.AuthenticationHook$install$1.invokeSuspend(AuthenticationInterceptors.kt:25)
	at io.ktor.server.auth.AuthenticationHook$install$1.invoke(AuthenticationInterceptors.kt)
	at io.ktor.server.auth.AuthenticationHook$install$1.invoke(AuthenticationInterceptors.kt)
	at io.ktor.server.application.ApplicationPluginKt$addAllInterceptors$1$1$1.invokeSuspend(ApplicationPlugin.kt:169)
	at io.ktor.server.application.ApplicationPluginKt$addAllInterceptors$1$1$1.invoke(ApplicationPlugin.kt)
	at io.ktor.server.application.ApplicationPluginKt$addAllInterceptors$1$1$1.invoke(ApplicationPlugin.kt)
	at io.ktor.util.pipeline.DebugPipelineContext.proceedLoop(DebugPipelineContext.kt:80)
	at io.ktor.util.pipeline.DebugPipelineContext.proceed(DebugPipelineContext.kt:57)
	at io.ktor.util.pipeline.DebugPipelineContext.execute$ktor_utils(DebugPipelineContext.kt:63)
	at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:77)
	at io.ktor.server.routing.Routing$executeResult$$inlined$execute$1.invokeSuspend(Pipeline.kt:478)
	at io.ktor.server.routing.Routing$executeResult$$inlined$execute$1.invoke(Pipeline.kt)
	at io.ktor.server.routing.Routing$executeResult$$inlined$execute$1.invoke(Pipeline.kt)
	at io.ktor.util.debug.ContextUtilsKt.initContextInDebugMode(ContextUtils.kt:17)
	at io.ktor.server.routing.Routing.executeResult(Routing.kt:190)
	at io.ktor.server.routing.Routing.interceptor(Routing.kt:64)
	at io.ktor.server.routing.Routing$Plugin$install$1.invokeSuspend(Routing.kt:140)
	at io.ktor.server.routing.Routing$Plugin$install$1.invoke(Routing.kt)
	at io.ktor.server.routing.Routing$Plugin$install$1.invoke(Routing.kt)
	at io.ktor.util.pipeline.DebugPipelineContext.proceedLoop(DebugPipelineContext.kt:80)
	at io.ktor.util.pipeline.DebugPipelineContext.proceed(DebugPipelineContext.kt:57)
	at io.ktor.server.engine.BaseApplicationEngineKt$installDefaultTransformationChecker$1.invokeSuspend(BaseApplicationEngine.kt:124)
	at io.ktor.server.engine.BaseApplicationEngineKt$installDefaultTransformationChecker$1.invoke(BaseApplicationEngine.kt)
	at io.ktor.server.engine.BaseApplicationEngineKt$installDefaultTransformationChecker$1.invoke(BaseApplicationEngine.kt)
	at io.ktor.util.pipeline.DebugPipelineContext.proceedLoop(DebugPipelineContext.kt:80)
	at io.ktor.util.pipeline.DebugPipelineContext.proceed(DebugPipelineContext.kt:57)
	at io.ktor.util.pipeline.DebugPipelineContext.execute$ktor_utils(DebugPipelineContext.kt:63)
	at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:77)
	at io.ktor.server.testing.TestApplicationEngine$3$invokeSuspend$$inlined$execute$1.invokeSuspend(Pipeline.kt:478)
	at io.ktor.server.testing.TestApplicationEngine$3$invokeSuspend$$inlined$execute$1.invoke(Pipeline.kt)
	at io.ktor.server.testing.TestApplicationEngine$3$invokeSuspend$$inlined$execute$1.invoke(Pipeline.kt)
	at io.ktor.util.debug.ContextUtilsKt.initContextInDebugMode(ContextUtils.kt:17)
	at io.ktor.server.testing.TestApplicationEngine$3.invokeSuspend(TestApplicationEngine.kt:311)
	at io.ktor.server.testing.TestApplicationEngine$3.invoke(TestApplicationEngine.kt)
	at io.ktor.server.testing.TestApplicationEngine$3.invoke(TestApplicationEngine.kt)
	at io.ktor.server.testing.TestApplicationEngine$2.invokeSuspend(TestApplicationEngine.kt:90)
	at io.ktor.server.testing.TestApplicationEngine$2.invoke(TestApplicationEngine.kt)
	at io.ktor.server.testing.TestApplicationEngine$2.invoke(TestApplicationEngine.kt)
	at io.ktor.util.pipeline.DebugPipelineContext.proceedLoop(DebugPipelineContext.kt:80)
	at io.ktor.util.pipeline.DebugPipelineContext.proceed(DebugPipelineContext.kt:57)
	at io.ktor.util.pipeline.DebugPipelineContext.execute$ktor_utils(DebugPipelineContext.kt:63)
	at io.ktor.util.pipeline.Pipeline.execute(Pipeline.kt:77)
	at io.ktor.server.testing.TestApplicationEngine$handleRequestNonBlocking$2$invokeSuspend$$inlined$execute$1.invokeSuspend(Pipeline.kt:478)
	at io.ktor.server.testing.TestApplicationEngine$handleRequestNonBlocking$2$invokeSuspend$$inlined$execute$1.invoke(Pipeline.kt)
	at io.ktor.server.testing.TestApplicationEngine$handleRequestNonBlocking$2$invokeSuspend$$inlined$execute$1.invoke(Pipeline.kt)
	at io.ktor.util.debug.ContextUtilsKt.initContextInDebugMode(ContextUtils.kt:17)
	at io.ktor.server.testing.TestApplicationEngine$handleRequestNonBlocking$2.invokeSuspend(TestApplicationEngine.kt:310)
	at io.ktor.server.testing.TestApplicationEngine$handleRequestNonBlocking$2.invoke(TestApplicationEngine.kt)
	at io.ktor.server.testing.TestApplicationEngine$handleRequestNonBlocking$2.invoke(TestApplicationEngine.kt)
	at kotlinx.coroutines.intrinsics.UndispatchedKt.startUndispatchedOrReturn(Undispatched.kt:78)
	at kotlinx.coroutines.BuildersKt__Builders_commonKt.withContext(Builders.common.kt:167)
	at kotlinx.coroutines.BuildersKt.withContext(Unknown Source)
	at io.ktor.server.testing.TestApplicationEngine.handleRequestNonBlocking$ktor_server_test_host(TestApplicationEngine.kt:225)
	at io.ktor.server.testing.TestApplicationEngine.handleRequestNonBlocking$ktor_server_test_host$default(TestApplicationEngine.kt:212)
	at io.ktor.server.testing.client.TestHttpClientEngine.runRequest(TestHttpClientEngine.kt:70)
	at io.ktor.server.testing.client.TestHttpClientEngine.execute(TestHttpClientEngine.kt:55)
	at io.ktor.server.testing.client.DelegatingTestClientEngine.execute(DelegatingTestClientEngine.kt:53)
	at io.ktor.client.engine.HttpClientEngine$executeWithinCallContext$2.invokeSuspend(HttpClientEngine.kt:99)
	at kotlin.coroutines.jvm.internal.BaseContinuationImpl.resumeWith(ContinuationImpl.kt:33)
	at kotlinx.coroutines.DispatchedTask.run(DispatchedTask.kt:108)
	at kotlinx.coroutines.internal.LimitedDispatcher$Worker.run(LimitedDispatcher.kt:115)
	at kotlinx.coroutines.scheduling.TaskImpl.run(Tasks.kt:103)
	at kotlinx.coroutines.scheduling.CoroutineScheduler.runSafely(CoroutineScheduler.kt:584)
	at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.executeTask(CoroutineScheduler.kt:793)
	at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.runWorker(CoroutineScheduler.kt:697)
	at kotlinx.coroutines.scheduling.CoroutineScheduler$Worker.run(CoroutineScheduler.kt:684)
Caused by: java.text.ParseException: Invalid JWT serialization: Missing dot delimiter(s)
	at com.nimbusds.jwt.JWTParser.parse(JWTParser.java:60)
	at no.nav.security.token.support.core.jwt.JwtToken.<init>(JwtToken.java:19)
	... 82 common frames omitted
2024-05-03 06:07:01.695  INFO k.test:167 - No ktor.deployment.watch patterns specified, automatic reload is not active.
2024-05-03 06:07:01.791  INFO k.test:65 - Application started in 0.096 seconds.
2024-05-03 06:07:01.792  INFO k.test:77 - Responding at http://localhost:80
2024-05-03 06:07:01.792  INFO k.test:77 - Responding at https://localhost:443
2024-05-03 06:07:01.852  INFO k.test:167 - No ktor.deployment.watch patterns specified, automatic reload is not active.
2024-05-03 06:07:01.955  INFO k.test:65 - Application started in 0.103 seconds.
2024-05-03 06:07:01.957  INFO k.test:77 - Responding at http://localhost:80
2024-05-03 06:07:01.957  INFO k.test:77 - Responding at https://localhost:443
]]></system-out>
  <system-err><![CDATA[]]></system-err>
</testsuite>
